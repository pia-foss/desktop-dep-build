From 4fc134ca2f5984f99848198ffbc87dcaaf915f80 Mon Sep 17 00:00:00 2001
From: Jonathon Hall <jonathon.hall@privateinternetaccess.com>
Date: Fri, 28 May 2021 09:47:20 -0400
Subject: [PATCH 3/3] Remove cgo

---
 embeddable-dll-service/main.go | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/embeddable-dll-service/main.go b/embeddable-dll-service/main.go
index 017f1921..95b34998 100644
--- a/embeddable-dll-service/main.go
+++ b/embeddable-dll-service/main.go
@@ -14,7 +14,13 @@
 package main
 
 import (
-	"C"
+	// wireguard-windows doesn't need cgo any more - all of the C API work was
+	// moved to wintun.dll.  The DLL itself is loaded with LoadLibrary/
+	// GetProcAddress using wrappers from golang.org/x/sys/windows.
+	// Worse though, cgo causes the module to crash during initialization
+	// (go 1.16.4 on Win 10), it seems to be a problem with initialization
+	// generated by cgo.
+	//"C"
 
 	"golang.org/x/sys/windows"
 
-- 
2.31.1.windows.1

